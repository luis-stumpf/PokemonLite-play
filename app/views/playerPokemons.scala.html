@import de.htwg.se.pokelite.model.PokemonType
@(player1Name: String, player2Name: String, allPokemons: Array[PokemonType])
@main("Choose your Pokemons") {
    @loadingScreen()
    @navbar("playerPokemons")
    @audio()
    <div class="container-fluid">
        <div class="row">
        <div class="choosePokemonsTitleContainer">
            <div class="chooseTitle">CHOOSE YOUR POKEMONS !</div>
        </div>
        <div class="showcase-box">
            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                <div class="img-wrapper">
                    @pokemon.name
                    <img class="pokemon-image img-fluid" src="@routes.Assets.versioned("images/pokemons/" + pokemon.name +"Front.gif")" height="200" alt="">
                </div>
            }
        </div>
        </div>
        <form  method="POST" action="/initPokemons" id="pokemonForm">
            <div class="pokemonSelectionContainer">
                <div class="pokemonSelection" id="selection1">
                    <div class="pokemonLabel">
                        <label for="player1Pokemon1">@player1Name's Pokemons: </label>
                    </div>
                    <div>
                        <select id="player1Pokemon1" name="player1Pokemon1">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option value="@(index + 1)">
                                @pokemon.name
                                </option>
                            }
                        </select>
                        <label for="player1Pokemon2"></label>
                        <select id="player1Pokemon2" name="player1Pokemon2">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option class="pokemonOptions" value="@(index + 1)">
                                @pokemon.name
                                </option>
                            }
                        </select>
                        <label for="player1Pokemon3"></label>
                        <select id="player1Pokemon3" name="player1Pokemon3">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option value="@(index + 1)">
                                @pokemon.name
                                </option>
                            }
                        </select>
                    </div>
                </div>
                <div class="pokemonSelection" id="selection2">
                    <div class="pokemonLabel">
                        <label for="player2Pokemon1">@player2Name's Pokemons: </label>
                    </div>
                    <div>
                        <select id="player2Pokemon1" name="player2Pokemon1">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option value="@(index + 1)">
                                    @pokemon.name
                                </option>
                            }
                        </select>
                        <label for="player2Pokemon2"></label>
                        <select id="player2Pokemon2" name="player2Pokemon2">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option value="@(index + 1)">
                                    @pokemon.name
                                </option>
                            }
                        </select>
                        <label for="player2Pokemon3"></label>
                        <select id="player2Pokemon3" name="player2Pokemon3">
                            <option value="" disabled selected style="display: none;"></option>
                            @for((pokemon, index) <- allPokemons.zipWithIndex) {
                                <option value="@(index + 1)">
                                    @pokemon.name
                                </option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="startButtonContainer">
                <input class="confirmButton" type="button" value="CONFIRM" onclick="checkSelection()">
            </div>
        </form>
    </div>
    <script>
            const titleScreenMusic = document.getElementById("titleScreenMusic");
            const buttonSound = document.getElementById("buttonSound");

            titleScreenMusic.volume = 0.2;

            function displayValidationAlert(message, inputId) {
                let inputField = document.getElementById(inputId);
                let alertDiv = document.createElement("div");
                alertDiv.className = "alert alert-warning alert-dismissible fade show mt-1";
                alertDiv.role = "alert";
                alertDiv.innerHTML = message;
                let closeButton = document.createElement("button");
                closeButton.type = "button";
                closeButton.className = "btn-close";
                closeButton.setAttribute("data-bs-dismiss", "alert");
                alertDiv.appendChild(closeButton);
                inputField.parentNode.appendChild(alertDiv);

                setTimeout(function () {
                    alertDiv.classList.add("fade-out");
                }, 2500);

                setTimeout(function () {
                    alertDiv.remove();
                }, 7600);
            }

            function checkSelection() {
                let player1Pokemon1 = document.getElementById("player1Pokemon1").value;
                let player1Pokemon2 = document.getElementById("player1Pokemon2").value;
                let player1Pokemon3 = document.getElementById("player1Pokemon3").value;

                let player2Pokemon1 = document.getElementById("player2Pokemon1").value;
                let player2Pokemon2 = document.getElementById("player2Pokemon2").value;
                let player2Pokemon3 = document.getElementById("player2Pokemon3").value;

                if ((player1Pokemon1.trim() === "" || player1Pokemon2.trim() === "" || player1Pokemon3.trim() === "")
                && (player2Pokemon1.trim() === "" || player2Pokemon2.trim() === "" || player2Pokemon3.trim() === "" )) {
                    displayValidationAlert("Please select your Pokemons player 1.", "selection1");
                    displayValidationAlert("Please select your Pokemons player 2.", "selection2");
                } else if (player1Pokemon1.trim() === "" || player1Pokemon2.trim() === "" || player1Pokemon3.trim() === "") {
                    displayValidationAlert("Please select your Pokemons player 1.", "selection1");
                } else if (player2Pokemon1.trim() === "" || player2Pokemon2.trim() === "" || player2Pokemon3.trim() === "") {
                    displayValidationAlert("Please select your Pokemons player 2.", "selection2");
                } else {
                    buttonSound.play();

                    setTimeout(() => {
                        document.getElementById("pokemonForm").submit();
                    }, 300);
                }
            }

            document.addEventListener("DOMContentLoaded", () => {
                if (titleScreenMusic) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const storedPosition = urlParams.get('position');
                    if (storedPosition !== null) {
                        titleScreenMusic.currentTime = parseFloat(storedPosition);
                        titleScreenMusic.play();
                    }
                }
            });

            document.addEventListener("DOMContentLoaded", function () {
                setTimeout(() => {
                    document.getElementById("loading-screen").style.display = "none";
                }, 1000);
            });

    </script>
}
